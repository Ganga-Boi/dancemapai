<!doctype html>
<html lang="da">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>DanceMap</title>

<style>
:root { color-scheme: dark; }
* { box-sizing: border-box; }
body {
  margin: 0;
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  background: #0b0f14;
  color: #e8eef7;
}

.wrap {
  max-width: 480px;
  margin: 0 auto;
  height: 100vh;
  display: flex;
  flex-direction: column;
}

/* HEADER */
.header {
  padding: 14px 16px;
  border-bottom: 1px solid #1a2432;
  background: #0e141d;
  display: flex;
  align-items: center;
  gap: 10px;
}
.header-avatar {
  width: 40px;
  height: 40px;
  border-radius: 50%;
}
.header-text { flex: 1; }
.header-text h1 {
  margin: 0;
  font-size: 18px;
  font-weight: 600;
}
.header-text .sub {
  font-size: 12px;
  opacity: .65;
}
.admin-btn {
  font-size: 12px;
  padding: 6px 10px;
  border-radius: 10px;
  border: 1px solid #2a3b54;
  background: #142235;
  color: #9fc5ff;
  cursor: pointer;
}

/* CHAT */
.chat {
  flex: 1;
  overflow-y: auto;
  padding: 16px;
  display: flex;
  flex-direction: column;
  gap: 12px;
}
.row { display: flex; }
.row.user { justify-content: flex-end; }
.row.bot { justify-content: flex-start; }
.bubble {
  max-width: 85%;
  padding: 10px 14px;
  border-radius: 16px;
  font-size: 14px;
  white-space: pre-wrap;
}
.user .bubble {
  background: #1e3a5f;
  border-bottom-right-radius: 4px;
}
.bot .bubble {
  background: #1a2432;
  border-bottom-left-radius: 4px;
}

/* INPUT BAR */
.bar {
  display: flex;
  gap: 10px;
  padding: 12px 16px;
  border-top: 1px solid #1a2432;
  background: #0e141d;
}
.bar input {
  flex: 1;
  padding: 12px 14px;
  border-radius: 20px;
  border: 1px solid #1a2432;
  background: #0b1017;
  color: #e8eef7;
}
.send-btn {
  width: 44px;
  height: 44px;
  border-radius: 50%;
  border: none;
  background: #1e3a5f;
  color: #fff;
  cursor: pointer;
}

/* ADMIN MODAL */
.modal-overlay {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,.7);
  z-index: 100;
  align-items: flex-end;
  justify-content: center;
}
.modal-overlay.open { display: flex; }

.modal {
  width: 100%;
  max-width: 480px;
  max-height: 90vh;
  background: #0e141d;
  border-top-left-radius: 20px;
  border-top-right-radius: 20px;
  padding: 20px 16px 24px;
  overflow-y: auto;
}

.modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
}
.modal-header h2 {
  margin: 0;
  font-size: 18px;
}
.modal-close {
  background: none;
  border: none;
  color: #9fc5ff;
  font-size: 24px;
  cursor: pointer;
}

.form-group { margin-bottom: 12px; }
.form-group label {
  display: block;
  font-size: 13px;
  margin-bottom: 6px;
  opacity: .8;
}
.form-group input,
.form-group select,
.form-group textarea {
  width: 100%;
  padding: 10px 12px;
  border-radius: 10px;
  border: 1px solid #1a2432;
  background: #0b1017;
  color: #e8eef7;
  font-size: 14px;
}
textarea {
  min-height: 90px;
  resize: vertical;
}

.form-row {
  display: flex;
  gap: 10px;
}
.form-row .form-group { flex: 1; }

.submit-btn {
  width: 100%;
  padding: 14px;
  border-radius: 12px;
  border: none;
  background: #1e3a5f;
  color: #fff;
  font-size: 15px;
  cursor: pointer;
}

.submit-status {
  text-align: center;
  padding: 10px;
  font-size: 14px;
}
.submit-status.success { color: #4ade80; }
.submit-status.error { color: #ff6b6b; }
</style>
</head>

<body>
<div class="wrap">
  <div class="header">
    <img src="./dancemap-icon.svg" class="header-avatar" />
    <div class="header-text">
      <h1>DanceMap</h1>
      <div class="sub">Kun danseevents i København</div>
    </div>
    <button class="admin-btn" id="openAdmin">Admin</button>
  </div>

  <div id="chat" class="chat"></div>

  <div class="bar">
    <input id="q" placeholder='Skriv fx: "salsa i dag"' />
    <button id="sendBtn" class="send-btn">➤</button>
  </div>
</div>

<!-- ADMIN MODAL -->
<div class="modal-overlay" id="adminModal">
  <div class="modal">
    <div class="modal-header">
      <h2>Admin – Tilføj event</h2>
      <button class="modal-close" id="closeAdmin">&times;</button>
    </div>

    <div class="form-group">
      <label>Copy/paste event-tekst (kun reference)</label>
      <textarea placeholder="Indsæt fx tekst fra Facebook her"></textarea>
    </div>

    <form id="adminForm">
      <div class="form-group">
        <label>Dato *</label>
        <input type="date" id="dato" required>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>Starttid *</label>
          <input type="time" id="starttid" required>
        </div>
        <div class="form-group">
          <label>Sluttid</label>
          <input type="time" id="sluttid">
        </div>
      </div>

      <div class="form-group">
        <label>Dansetype *</label>
        <select id="dansetype" required>
          <option value="">Vælg…</option>
          <option>Salsa</option>
          <option>Bachata</option>
          <option>Kizomba</option>
          <option>Tango</option>
          <option>Swing</option>
          <option>Zouk</option>
          <option>West Coast Swing</option>
          <option>Lindy Hop</option>
          <option>Latin</option>
        </select>
      </div>

      <div class="form-group">
        <label>Sted *</label>
        <input id="sted" required>
      </div>

      <div class="form-group">
        <label>Adresse</label>
        <input id="adresse">
      </div>

      <div class="form-group">
        <label>Pris</label>
        <input id="pris">
      </div>

      <div class="form-group">
        <label>Arrangør</label>
        <input id="arrangoer">
      </div>

      <div class="form-group">
        <label>Link</label>
        <input id="link">
      </div>

      <div class="form-group">
        <label>Recurring</label>
        <select id="recurring">
          <option value="none">Ingen</option>
          <option value="weekly">Ugentlig</option>
          <option value="festival">Festival</option>
        </select>
      </div>

      <button class="submit-btn" type="submit">Tilføj til Events</button>
      <div id="adminStatus" class="submit-status"></div>
    </form>
  </div>
</div>

<script>
const API_URL = 'https://script.google.com/macros/s/AKfycbxnZiO0bDkCrrwGJXwAvA5mWKPBoQoL-t1smx5m0A5j51gSbTOtF1MLT3qkdwbZkTX_/exec';

const chat = document.getElementById('chat');
const q = document.getElementById('q');
const sendBtn = document.getElementById('sendBtn');

function add(type, text) {
  const r = document.createElement('div');
  r.className = 'row ' + type;
  const b = document.createElement('div');
  b.className = 'bubble';
  b.textContent = text;
  r.appendChild(b);
  chat.appendChild(r);
  chat.scrollTop = chat.scrollHeight;
}

async function callApi(query, page) {
  const u = new URL(API_URL);
  u.searchParams.set('query', query);
  u.searchParams.set('page', page);
  const r = await fetch(u);
  return r.json();
}

sendBtn.onclick = async () => {
  if (!q.value.trim()) return;
  add('user', q.value);
  const t = q.value;
  q.value = '';
  add('bot', 'DanceMap skriver …');
  const d = await callApi(t, 0);
  chat.lastChild.remove();
  add('bot', d.text || 'Ingen events.');
};

q.addEventListener('keydown', e => {
  if (e.key === 'Enter') sendBtn.click();
});

add('bot', 'Jeg viser danseevents i København. Søg fx: "salsa i dag", "bachata i weekenden" eller "kizomba fredag".');

/* ADMIN */
const adminModal = document.getElementById('adminModal');
document.getElementById('openAdmin').onclick = () => adminModal.classList.add('open');
document.getElementById('closeAdmin').onclick = () => adminModal.classList.remove('open');
adminModal.onclick = e => { if (e.target === adminModal) adminModal.classList.remove('open'); };

document.getElementById('adminForm').onsubmit = async (e) => {
  e.preventDefault();
  const status = document.getElementById('adminStatus');
  status.textContent = 'Sender…';
  status.className = 'submit-status';

  const payload = {
    action: 'admin-submit',
    dato: dato.value,
    starttid: starttid.value,
    sluttid: sluttid.value,
    dansetype: dansetype.value,
    sted: sted.value,
    adresse: adresse.value,
    pris: pris.value,
    arrangoer: arrangoer.value,
    link: link.value,
    recurring: recurring.value
  };

  try {
    const r = await fetch(API_URL, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload)
    });
    const d = await r.json();

    if (d.success) {
      status.textContent = d.text;
      status.className = 'submit-status success';
      e.target.reset();
    } else {
      status.textContent = d.text || 'Fejl';
      status.className = 'submit-status error';
    }
  } catch {
    status.textContent = 'Teknisk fejl';
    status.className = 'submit-status error';
  }
};
</script>
</body>
</html>
