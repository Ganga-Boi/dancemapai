<!doctype html>
<html lang="da">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>DanceMap</title>

<style>
body{margin:0;font-family:system-ui;background:#0b0f14;color:#e8eef7}
.wrap{max-width:480px;margin:0 auto;height:100vh;display:flex;flex-direction:column}
.header{padding:14px 16px;background:#0e141d;border-bottom:1px solid #1a2432;display:flex;gap:10px;align-items:center}
.header img{width:40px;height:40px;border-radius:50%}
.chat{flex:1;overflow-y:auto;padding:16px;display:flex;flex-direction:column;gap:12px}
.row{display:flex}
.user{justify-content:flex-end}
.bot{justify-content:flex-start}
.bubble{padding:10px 14px;border-radius:16px;max-width:85%;white-space:pre-wrap}
.user .bubble{background:#1e3a5f}
.bot .bubble{background:#1a2432}
.bar{display:flex;gap:10px;padding:12px;border-top:1px solid #1a2432}
input{flex:1;padding:12px;border-radius:20px;border:1px solid #1a2432;background:#0b1017;color:#e8eef7}
button{width:44px;border-radius:50%;background:#1e3a5f;color:#fff;border:none}
.modal{position:fixed;inset:0;background:rgba(0,0,0,.7);display:none;align-items:flex-end;justify-content:center}
.modal.open{display:flex}
.panel{background:#0e141d;width:100%;max-width:480px;border-radius:20px 20px 0 0;padding:16px}
textarea{width:100%;height:160px;background:#0b1017;color:#e8eef7;border:1px solid #1a2432;border-radius:10px;padding:10px}
</style>
</head>

<body>
<div class="wrap">
  <div class="header">
    <img src="./dancemap-icon.svg">
    <div><strong>DanceMap</strong><div style="opacity:.6;font-size:12px">Kun danseevents i København</div></div>
  </div>

  <div id="chat" class="chat"></div>

  <div class="bar">
    <input id="q" placeholder="Skriv fx: salsa i dag">
    <button id="send">➤</button>
  </div>
</div>

<div id="admin" class="modal">
  <div class="panel">
    <h3>Admin – Paste / Scrape</h3>
    <textarea id="paste"></textarea>
    <button id="import">Tilføj event</button>
    <div id="status"></div>
  </div>
</div>

<script>
const API_URL = 'INDSAET_DIN_APPS_SCRIPT_WEBAPP_URL_HER';
const chat=document.getElementById('chat');
const q=document.getElementById('q');

function add(t,c){const r=document.createElement('div');r.className='row '+c;const b=document.createElement('div');b.className='bubble';b.textContent=t;r.appendChild(b);chat.appendChild(r);chat.scrollTop=chat.scrollHeight}

document.getElementById('send').onclick=async()=>{
  const t=q.value.trim(); if(!t)return; q.value='';
  add(t,'user');
  const u=new URL(API_URL);u.searchParams.set('query',t);u.searchParams.set('page','0');
  const r=await fetch(u);const d=await r.json();
  add(d.text,'bot');
};

if(new URLSearchParams(location.search).get('admin')==='1'){
  document.addEventListener('keydown',e=>{
    if(e.ctrlKey&&e.shiftKey&&e.key==='A'){e.preventDefault();document.getElementById('admin').classList.toggle('open')}
  });
}

document.getElementById('import').onclick=async()=>{
  const t=document.getElementById('paste').value.trim();
  const r=await fetch(API_URL,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({action:'admin-import',payload:t})});
  const d=await r.json();
  document.getElementById('status').textContent=d.text;
  if(d.success)document.getElementById('paste').value='';
};

add('Jeg viser danseevents i København. Søg fx "salsa i dag".','bot');
</script>
</body>
</html>
