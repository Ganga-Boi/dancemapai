<!doctype html>
<html lang="da">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
  <title>DanceMap</title>

  <link rel="manifest" href="/manifest.json" />
  <meta name="theme-color" content="#6366f1" />

  <!-- API config -->
  <script src="/api-config.js"></script>

  <!-- Admin styles (påvirker ikke frontend) -->
  <link rel="stylesheet" href="/admin.css" />
</head>

<body>

<!-- ============================= -->
<!-- APP -->
<!-- ============================= -->
<div id="app">
  <!-- dit eksisterende UI ligger her -->
  <div id="weekCount"></div>
</div>

<!-- ============================= -->
<!-- FALLBACK -->
<!-- ============================= -->
<div id="fallback"
     style="display:none;position:fixed;inset:0;background:#0f0f23;color:#fff;
            z-index:9999;display:flex;align-items:center;justify-content:center;
            text-align:center;padding:20px;">
  <div>
    <img src="/fallback.png" alt="DanceMap nede" style="width:120px;margin-bottom:20px;">
    <div>DanceMap er midlertidigt nede.<br>Prøv igen senere.</div>
  </div>
</div>

<!-- ============================= -->
<!-- ADMIN ROOT -->
<!-- ============================= -->
<div id="admin-root" style="display:none"></div>

<!-- ============================= -->
<!-- SCRIPT -->
<!-- ============================= -->
<script>
/* ========= API ========= */
const API_SEARCH = window.DANCEMAP_API.search;
const API_WEEKCOUNT = window.DANCEMAP_API.weekcount;

/* ========= FALLBACK ========= */
function showFallback() {
  document.getElementById('fallback').style.display = 'flex';
}

/* ========= JSONP SEARCH ========= */
function search(query) {
  return new Promise((resolve, reject) => {
    const cb = 'cb_' + Date.now();
    window[cb] = (data) => {
      delete window[cb];
      script.remove();
      resolve(data);
    };

    const script = document.createElement('script');
    script.src =
      API_SEARCH +
      '?query=' + encodeURIComponent(query) +
      '&callback=' + cb;

    script.onerror = () => {
      delete window[cb];
      script.remove();
      showFallback();
      reject();
    };

    document.body.appendChild(script);
  });
}

/* ========= JSONP WEEKCOUNT ========= */
function loadWeekCount() {
  const cb = 'wc_' + Date.now();
  window[cb] = (data) => {
    delete window[cb];
    script.remove();
    if (data.success && data.count > 0) {
      document.getElementById('weekCount').textContent =
        data.count + ' events denne uge';
    }
  };

  const script = document.createElement('script');
  script.src = API_WEEKCOUNT + '?callback=' + cb;
  script.onerror = showFallback;

  document.body.appendChild(script);
}
loadWeekCount();

/* ========= ADMIN TOGGLE ========= */
function openAdmin() {
  document.getElementById('admin-root').style.display = 'block';
  console.log('Admin UI åbnet');
}
</script>

<!-- ============================= -->
<!-- ADMIN SCRIPT -->
<!-- ============================= -->
<script src="/admin.js"></script>

</body>
</html>
