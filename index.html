<!doctype html>
<html lang="da">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
  <title>DanceMap</title>

  <link rel="manifest" href="/manifest.json" />
  <meta name="theme-color" content="#6366f1" />

  <!-- API config -->
  <script src="/api-config.js"></script>

  <!-- Admin styles (påvirker ikke frontend) -->
  <link rel="stylesheet" href="/admin.css" />
</head>

<body>

<!-- ============================= -->
<!-- DIN EKSISTERENDE UI -->
<!-- ============================= -->

<div id="app">
  <!-- her ligger dit søgefelt, chat UI, resultater osv. -->
</div>

<!-- ============================= -->
<!-- FALLBACK / FEJLSIDE -->
<!-- ============================= -->
<div id="fallback"
     style="display:none;
            position:fixed;
            inset:0;
            background:#0f0f23;
            color:#fff;
            z-index:9999;
            display:flex;
            align-items:center;
            justify-content:center;
            text-align:center;
            padding:20px;">
  <div>
    <img src="/fallback.png" alt="DanceMap nede" style="width:120px;margin-bottom:20px;">
    <div>DanceMap er midlertidigt nede.<br>Prøv igen senere.</div>
  </div>
</div>

<!-- ============================= -->
<!-- ADMIN ROOT -->
<!-- ============================= -->
<div id="admin-root" style="display:none"></div>

<!-- ============================= -->
<!-- SCRIPT -->
<!-- ============================= -->
<script>
/* ========= API ========= */
const API = window.DANCEMAP_API.search;

/* ========= SEARCH ========= */
async function search(q) {
  try {
    const res = await fetch(API + '?query=' + encodeURIComponent(q), { cache: 'no-store' });
    if (!res.ok) throw new Error('API error');
    return await res.json();
  } catch {
    showFallback();
    return null;
  }
}

/* ========= WEEK COUNT ========= */
async function loadWeekCount() {
  try {
    const res = await fetch(window.DANCEMAP_API.weekcount, { cache: 'no-store' });
    const data = await res.json();
    if (data.success && data.count > 0) {
      document.getElementById('weekCount').textContent =
        data.count + ' events denne uge';
    }
  } catch {
    /* ignorer */
  }
}
loadWeekCount();

/* ========= FALLBACK ========= */
function showFallback() {
  document.getElementById('fallback').style.display = 'flex';
}

/* ========= ADMIN TOGGLE ========= */
function openAdmin() {
  document.getElementById('admin-root').style.display = 'block';
  console.log('Admin UI åbnet');
}
</script>

<!-- ============================= -->
<!-- ADMIN SCRIPT -->
<!-- ============================= -->
<script src="/admin.js"></script>

</body>
</html>
