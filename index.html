<!DOCTYPE html>
<html lang="da">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>DanceMap AI</title>

<style>
    body {
        margin: 0;
        background: linear-gradient(180deg, #022033, #01131f);
        font-family: "Segoe UI", sans-serif;
        color: #fff;
    }

    .app {
        height: 100vh;
        display: flex;
        flex-direction: column;
    }

    .topbar {
        height: 64px;
        background: #011e30;
        display: flex;
        align-items: center;
        padding: 0 20px;
        font-size: 22px;
        font-weight: bold;
        box-shadow: 0 2px 10px #0007;
    }

    .chat {
        flex: 1;
        padding: 20px;
        overflow-y: auto;
    }

    .msg {
        max-width: 80%;
        padding: 12px 16px;
        margin-bottom: 16px;
        border-radius: 12px;
        line-height: 1.4;
        display: flex;
        gap: 10px;
        align-items: flex-start;
    }

    .msg.user {
        background: #0088ff;
        margin-left: auto;
    }

    .msg.bot {
        background: #0a2536;
        border: 1px solid #0f3a51;
    }

    /* BOT AVATAR */
    .bot-icon {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: #1e90ff;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        font-size: 20px;
        color: white;
        flex-shrink: 0;
        box-shadow: 0 0 10px #0008;
    }

    /* Input bar */
    .inputBar {
        display: flex;
        padding: 15px;
        background: #011e30;
        gap: 10px;
    }

    #userInput {
        flex: 1;
        padding: 14px;
        border: none;
        border-radius: 8px;
        font-size: 16px;
        outline: none;
    }

    #sendBtn {
        width: 48px;
        height: 48px;
        background: #0088ff;
        color: #fff;
        border: none;
        border-radius: 50%;
        cursor: pointer;
        font-size: 18px;
    }
</style>
</head>

<body>
<div class="app">
    <div class="topbar">DanceMap AI</div>

    <div id="chat" class="chat"></div>

    <div class="inputBar">
        <input id="userInput" type="text" placeholder="Skriv en besked..." />
        <button id="sendBtn" onclick="sendMessage()">âž¤</button>
    </div>
</div>

<script>
const backendURL = "https://script.google.com/macros/s/AKfycbzmyLKzaezYgeNH1fuoJQHhdl2EAuVhhRg8xePwjw00aucUwMSxpBSylx3gIOYsBZco/exec";

/* ADD MESSAGE */
function addMessage(text, who, skipType = false) {
    const chat = document.getElementById("chat");

    const box = document.createElement("div");
    box.className = "msg " + who;

    if (who === "bot") {
        const icon = document.createElement("div");
        icon.className = "bot-icon";
        icon.textContent = "A";
        box.appendChild(icon);
    }

    const span = document.createElement("div");
    box.appendChild(span);

    chat.appendChild(box);
    chat.scrollTop = 999999;

    if (skipType) {
        span.textContent = text;
        return;
    }

    let i = 0;
    function type() {
        if (i < text.length) {
            span.textContent += text.charAt(i);
            i++;
            setTimeout(type, 20);
        }
    }
    type();
}

/* FIRST MESSAGE */
window.onload = () => {
    addMessage("Hej Allan! Jeg er klar til at finde salsa og bachata events.", "bot", true);
};

/* SEND MESSAGE */
function sendMessage() {
    const input = document.getElementById("userInput");
    const text = input.value.trim();
    if (!text) return;

    addMessage(text, "user");
    input.value = "";

    const formData = new FormData();
    formData.append("text", text);

    fetch(backendURL, {
        method: "POST",
        body: formData
    })
    .then(res => res.json())
    .then(data => {
        addMessage(data.reply || "Intet svar modtaget.", "bot");
    })
    .catch(err => {
        addMessage("Der skete en fejl.", "bot");
    });
}
</script>

</body>
</html>
