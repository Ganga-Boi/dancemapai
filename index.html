<!DOCTYPE html>
<html lang="da">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>DanceMap</title>

<style>
:root{
  --bg:#0b0f14;
  --card:#141a22;
  --border:#6b4cff;
  --salsa1:#5b6cff;
  --salsa2:#8b5cff;
  --bachata1:#ff6aa2;
  --bachata2:#ffb86b;
  --text:#e8ebf0;
  --muted:#9aa4b2;
}
*{box-sizing:border-box}
body{
  margin:0;
  min-height:100vh;
  background:radial-gradient(1200px 600px at 50% -10%, #141a22 0%, var(--bg) 60%);
  color:var(--text);
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu;
  display:flex;
  align-items:center;
  justify-content:center;
}
.app{
  width:420px;
  max-width:92vw;
}
.header{
  display:flex;
  gap:12px;
  align-items:center;
  margin-bottom:16px;
}
.logo{
  width:42px;height:42px;border-radius:50%;
  border:2px solid #2f9bff;
  display:grid;place-items:center;
}
.title{
  font-size:20px;font-weight:700;
}
.subtitle{
  font-size:13px;color:var(--muted);
}
.badge{
  color:#ff9f1a;font-size:12px;margin-top:2px;
}
.card{
  background:linear-gradient(180deg,#141a22,#11161d);
  border-radius:22px;
  border:1px solid rgba(255,255,255,.06);
  padding:16px;
  box-shadow:0 20px 60px rgba(0,0,0,.45);
  position:relative;
}
.card:before{
  content:"";
  position:absolute;inset:-1px;
  border-radius:22px;
  background:linear-gradient(90deg,var(--border),#ff7ad9);
  z-index:-1;
  opacity:.35;
}
.tabs{
  display:flex;gap:12px;margin-bottom:16px;
}
.tab{
  flex:1;
  padding:12px 0;
  border-radius:14px;
  text-align:center;
  cursor:pointer;
  font-weight:600;
  user-select:none;
}
.tab.salsa{
  background:linear-gradient(90deg,var(--salsa1),var(--salsa2));
}
.tab.bachata{
  background:linear-gradient(90deg,var(--bachata1),var(--bachata2));
}
.events{
  min-height:120px;
}
.event{
  background:#0f141b;
  border-radius:14px;
  padding:12px;
  margin-bottom:10px;
  font-size:14px;
  white-space:pre-line;
}
.empty{
  background:#0f141b;
  border-radius:14px;
  padding:14px;
  color:var(--muted);
}
.footer{
  text-align:center;
  font-size:13px;
  color:var(--muted);
  margin-top:12px;
}
.footer a{color:#7aa2ff;text-decoration:none}
</style>
</head>

<body>
<div class="app">
  <div class="header">
    <div class="logo">ğŸ¤–</div>
    <div>
      <div class="title">DanceMap</div>
      <div class="subtitle">Salsa og Bachata events i KÃ¸benhavn</div>
      <div class="badge">Ny version tilgÃ¦ngelig</div>
    </div>
  </div>

  <div class="card">
    <div class="tabs">
      <div class="tab salsa" onclick="loadEvents('salsa')">Salsa</div>
      <div class="tab bachata" onclick="loadEvents('bachata')">Bachata</div>
    </div>

    <div id="events" class="events"></div>

    <div class="footer">
      Kender du et event? <a href="submit.html">ï¼‹ TilfÃ¸j her</a>
    </div>
  </div>
</div>

<script>
/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   KONFIG
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const API = 'DIN_APPS_SCRIPT_URL/exec'; // â† behold din rigtige URL her

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   JSONP
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function jsonp(url, timeout=15000){
  return new Promise((resolve,reject)=>{
    const cb='cb_'+Math.random().toString(36).slice(2);
    const s=document.createElement('script');
    const t=setTimeout(()=>{
      cleanup();reject(new Error('timeout'));
    },timeout);
    function cleanup(){
      delete window[cb];
      if(s.parentNode)s.parentNode.removeChild(s);
      clearTimeout(t);
    }
    window[cb]=data=>{cleanup();resolve(data);};
    s.src=url+(url.includes('?')?'&':'?')+'callback='+cb;
    document.body.appendChild(s);
  });
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   SEARCH â€“ TILPASSET BACKEND v3.7.x
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
async function search(query){
  const data = await jsonp(
    API+'?query='+encodeURIComponent(query)+'&_='+Date.now()
  );

  // ğŸ”‘ KRITISK FIX: backend â†’ frontend-format
  if(data && Array.isArray(data.events)){
    data.text = data.events.map(e=>{
      return [
        e.Dato && 'ğŸ—“ '+e.Dato,
        e.Navn && 'ğŸ“Œ '+e.Navn,
        (e.Starttid||e.Sluttid) && 'ğŸ•— '+[e.Starttid,e.Sluttid].filter(Boolean).join('â€“'),
        e.Dansetype && 'ğŸ’ƒ '+e.Dansetype,
        e.Sted && 'ğŸ“ '+e.Sted,
        e.Pris && 'ğŸ’° '+e.Pris,
        e.Link && 'ğŸ« '+e.Link
      ].filter(Boolean).join('\n');
    }).join('\n\n');
  }
  return data;
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   UI
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
async function loadEvents(type){
  const box=document.getElementById('events');
  box.innerHTML='';
  try{
    const data=await search(type);
    if(!data.text){
      box.innerHTML='<div class="empty">Ingen events fundet for "'+type+'"</div>';
      return;
    }
    data.text.split(/\n\n+/).forEach(block=>{
      const d=document.createElement('div');
      d.className='event';
      d.textContent=block;
      box.appendChild(d);
    });
  }catch(e){
    box.innerHTML='<div class="empty">Fejl ved hentning af events</div>';
  }
}

// default
loadEvents('salsa');
</script>
</body>
</html>
