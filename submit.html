<!DOCTYPE html>
<html lang="da">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>DanceMap ‚Äì Arrang√∏r Portal</title>
  <link rel="icon" href="/dancemap-icon.svg" type="image/svg+xml">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: #0d1117;
      color: #e6edf3;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 24px 16px;
    }
    
    .header {
      display: flex;
      align-items: center;
      gap: 14px;
      margin-bottom: 24px;
      width: 100%;
      max-width: 440px;
    }
    
    .logo img { width: 52px; height: 52px; border-radius: 12px; }
    .header-text h1 { font-size: 20px; font-weight: 600; color: #e6edf3; margin-bottom: 2px; }
    .header-text .sub { font-size: 13px; color: #7d8590; }
    
    .card {
      background: #161b22;
      border-radius: 20px;
      width: 100%;
      max-width: 440px;
      padding: 28px 24px;
      position: relative;
    }
    
    .card::before {
      content: '';
      position: absolute;
      inset: -2px;
      border-radius: 22px;
      background: linear-gradient(90deg, #ff0000, #ff8000, #ffff00, #00ff00, #00ffff, #0080ff, #8000ff, #ff00ff, #ff0000);
      background-size: 400% 100%;
      animation: gradient-shift 8s linear infinite;
      z-index: -1;
    }
    
    @keyframes gradient-shift {
      0% { background-position: 0% 50%; }
      100% { background-position: 400% 50%; }
    }
    
    .intro { text-align: center; margin-bottom: 24px; }
    .intro h2 { font-size: 18px; font-weight: 600; margin-bottom: 8px; }
    .intro p { font-size: 14px; color: #8b949e; line-height: 1.5; }
    
    .field-row { margin-bottom: 14px; }
    .field-row label { display: block; font-size: 12px; margin-bottom: 6px; color: #7d8590; }
    .field-row input, .field-row select {
      width: 100%; padding: 12px 14px; border-radius: 10px; border: 1px solid #30363d;
      background: #0d1117; color: #e6edf3; font-size: 14px; font-family: inherit; outline: none;
    }
    .field-row input:focus, .field-row select:focus { border-color: #6366f1; }
    .field-row.two-col { display: flex; gap: 12px; }
    .field-row.two-col > div { flex: 1; }
    
    .checkbox-group {
      display: flex; align-items: center; gap: 12px; margin-bottom: 16px;
      padding: 14px; background: #0d1117; border-radius: 10px;
    }
    .checkbox-group input[type="checkbox"] { width: 20px; height: 20px; accent-color: #6366f1; }
    .checkbox-group label { font-size: 14px; color: #c9d1d9; cursor: pointer; }
    
    .btn-row { display: flex; gap: 10px; margin-top: 16px; }
    
    .submit-btn {
      flex: 1; padding: 16px; border-radius: 12px; border: none;
      background: #6366f1; color: white; font-size: 15px; font-weight: 600; cursor: pointer;
    }
    .submit-btn:hover { background: #5558e3; }
    .submit-btn:disabled { opacity: 0.6; cursor: not-allowed; }
    
    .clear-btn {
      padding: 16px 20px; border-radius: 12px; border: 1px solid #30363d;
      background: transparent; color: #7d8590; font-size: 15px; cursor: pointer;
    }
    .clear-btn:hover { border-color: #f85149; color: #f85149; }
    
    .status {
      text-align: center; padding: 14px; border-radius: 10px; margin-top: 16px; font-size: 14px; display: none;
    }
    .status.success { background: rgba(63, 185, 80, 0.15); color: #3fb950; display: block; }
    .status.error { background: rgba(248, 81, 73, 0.15); color: #f85149; display: block; }
    
    .preview-card { background: #21262d; border-radius: 12px; padding: 14px 16px; margin-bottom: 16px; }
    .preview-label { font-size: 11px; color: #7d8590; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 10px; }
    .preview-content { font-size: 14px; color: #c9d1d9; line-height: 1.6; }
    .preview-content .line { display: flex; gap: 8px; margin-bottom: 4px; }
    .preview-content .icon { width: 20px; text-align: center; }
    
    .footer { margin-top: 24px; text-align: center; font-size: 12px; color: #484f58; }
    .footer a { color: #6366f1; text-decoration: none; }
    
    .lock-icon { font-size: 48px; margin-bottom: 16px; }
    .password-input { text-align: center; letter-spacing: 8px; font-size: 24px; font-weight: 600; }
    
    .success-card { text-align: center; }
    .success-icon { font-size: 48px; margin-bottom: 16px; }
    .success-message h3 { font-size: 18px; margin-bottom: 8px; color: #3fb950; }
    .success-message p { color: #8b949e; font-size: 14px; line-height: 1.5; margin-bottom: 8px; }
    .success-message .event-name { color: #e6edf3; font-weight: 600; font-size: 16px; margin-bottom: 16px; }
    .success-message .note { font-size: 12px; color: #6e7681; margin-top: 12px; }
    .add-another {
      margin-top: 20px; padding: 12px 24px; border-radius: 10px; border: 1px solid #30363d;
      background: transparent; color: #e6edf3; font-size: 14px; cursor: pointer;
    }
    .add-another:hover { border-color: #6366f1; background: rgba(99, 102, 241, 0.1); }
    
    .spinner {
      display: inline-block; width: 16px; height: 16px; border: 2px solid rgba(255,255,255,0.3);
      border-radius: 50%; border-top-color: white; animation: spin 0.8s linear infinite;
      margin-right: 8px; vertical-align: middle;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
  </style>
</head>
<body>

<div class="header">
  <div class="logo"><img src="/dancemap-icon.svg" alt="DanceMap" /></div>
  <div class="header-text">
    <h1>DanceMap for Arrang√∏rer</h1>
    <div class="sub">Del dit event med dansemilj√∏et</div>
  </div>
</div>

<!-- PASSWORD GATE -->
<div class="card" id="passwordCard">
  <div class="intro">
    <div class="lock-icon">üîí</div>
    <h2>Arrang√∏r-adgang</h2>
    <p>Indtast adgangskode for at forts√¶tte</p>
  </div>
  <div class="field-row">
    <input type="password" id="password" class="password-input" placeholder="****" maxlength="4" />
  </div>
  <button class="submit-btn" id="pwBtn">Forts√¶t</button>
  <div class="status" id="passwordStatus"></div>
</div>

<!-- MAIN FORM -->
<div class="card" id="mainCard" style="display:none;">
  <div class="intro">
    <h2>üéâ Tilf√∏j dit event</h2>
    <p>Udfyld felterne og dit event bliver tilf√∏jet</p>
  </div>
  
  <form id="eventForm">
    <div class="field-row">
      <label>Dit navn / organisation *</label>
      <input type="text" id="kilde" required />
    </div>
    
    <div class="field-row">
      <label>Event navn *</label>
      <input type="text" id="navn" required />
    </div>
    
    <div class="field-row">
      <label>Dato *</label>
      <input type="date" id="dato" required />
    </div>
    
    <div class="field-row two-col">
      <div><label>Start *</label><input type="time" id="starttid" required /></div>
      <div><label>Slut *</label><input type="time" id="sluttid" required /></div>
    </div>
    
    <div class="field-row">
      <label>Dansetype *</label>
      <select id="dansetype" required>
        <option value="Salsa">Salsa</option>
        <option value="Bachata">Bachata</option>
        <option value="Kizomba">Kizomba</option>
        <option value="Zouk">Zouk</option>
        <option value="Tango">Tango</option>
        <option value="Swing">Swing</option>
        <option value="Latin">Latin</option>
      </select>
    </div>
    
    <div class="field-row">
      <label>Sted *</label>
      <input type="text" id="sted" required />
    </div>
    
    <div class="field-row">
      <label>Adresse *</label>
      <input type="text" id="adresse" required />
    </div>
    
    <div class="field-row">
      <label>By *</label>
      <input type="text" id="by" value="K√∏benhavn" required />
    </div>
    
    <div class="field-row">
      <label>Pristype</label>
      <select id="prisType">
        <option value="angiv">Angiv priser</option>
        <option value="gratis">Gratis</option>
        <option value="kontakt">Kontakt arrang√∏r</option>
      </select>
    </div>
    
    <div id="prisFields">
      <div class="field-row two-col">
        <div><label>Online pris (kr)</label><input type="text" id="prisOnline" placeholder="50" /></div>
        <div><label>Drop-in pris (kr)</label><input type="text" id="prisDropin" placeholder="70" /></div>
      </div>
    </div>
    
    <div class="field-row">
      <label>Billet-link (valgfrit)</label>
      <input type="url" id="link" placeholder="https://..." />
    </div>
    
    <div class="checkbox-group">
      <input type="checkbox" id="recurring" />
      <label for="recurring">Gentager ugentligt</label>
    </div>
    
    <div id="previewCard" class="preview-card">
      <div class="preview-label">Forh√•ndsvisning</div>
      <div id="previewContent" class="preview-content"></div>
    </div>
    
    <div class="btn-row">
      <button type="button" class="clear-btn" id="clearBtn">Ryd</button>
      <button type="submit" class="submit-btn" id="submitBtn">üöÄ Send event</button>
    </div>
    
    <div class="status" id="addStatus"></div>
  </form>
</div>

<!-- SUCCESS CARD -->
<div class="card success-card" id="successCard" style="display:none;">
  <div class="success-icon">‚úÖ</div>
  <div class="success-message">
    <h3>Event indsendt!</h3>
    <div class="event-name" id="successEventName"></div>
    <p>Eventet er lagt ind i systemet og afventer godkendelse.</p>
    <p class="note">Du f√•r besked n√•r eventet er live p√• DanceMap.</p>
  </div>
  <button class="add-another" id="addAnotherBtn">+ Tilf√∏j endnu et event</button>
</div>

<div class="footer">
  <a href="/">‚Üê Tilbage til DanceMap</a>
</div>

<script>
var API = 'https://script.google.com/macros/s/AKfycbyJdVscl-4f-ow7Ynj-LGsazpGFSR8VzVZWHruWdNE66HbVK6LJLOXKRmS6TFUUFC6i/exec';
var PASSWORD = '2026';
var submittedEventName = '';

function $(id) { return document.getElementById(id); }

// Password
$('pwBtn').onclick = function() {
  if ($('password').value === PASSWORD) {
    $('passwordCard').style.display = 'none';
    $('mainCard').style.display = 'block';
    localStorage.setItem('dm_access', '1');
    loadName();
  } else {
    $('passwordStatus').textContent = 'Forkert kode';
    $('passwordStatus').className = 'status error';
  }
};

if (localStorage.getItem('dm_access') === '1') {
  $('passwordCard').style.display = 'none';
  $('mainCard').style.display = 'block';
  loadName();
}

$('password').onkeyup = function(e) { if (e.key === 'Enter') $('pwBtn').click(); };

function loadName() {
  var n = localStorage.getItem('dm_name');
  if (n) $('kilde').value = n;
}

$('kilde').onblur = function() {
  if (this.value.trim()) localStorage.setItem('dm_name', this.value.trim());
};

// Pristype
$('prisType').onchange = function() {
  $('prisFields').style.display = this.value === 'angiv' ? 'block' : 'none';
  updatePreview();
};

function buildPris() {
  var pt = $('prisType').value;
  if (pt === 'gratis') return 'Gratis';
  if (pt === 'kontakt') return 'Kontakt arrang√∏r';
  var o = $('prisOnline').value.trim();
  var d = $('prisDropin').value.trim();
  if (o && d) return o + ' kr (online) / ' + d + ' kr (drop-in)';
  if (o) return o + ' kr (online)';
  if (d) return d + ' kr (drop-in)';
  return '';
}

function updatePreview() {
  var dage = ['S√∏n','Man','Tir','Ons','Tor','Fre','L√∏r'];
  var mdr = ['jan','feb','mar','apr','maj','jun','jul','aug','sep','okt','nov','dec'];
  
  var datoStr = '‚Äî';
  if ($('dato').value) {
    var d = new Date($('dato').value);
    if (!isNaN(d.getTime())) {
      datoStr = dage[d.getDay()] + ' ' + d.getDate() + '. ' + mdr[d.getMonth()];
      if ($('recurring').checked) datoStr += ' üîÅ';
    }
  }
  
  var tidStr = $('starttid').value || '‚Äî';
  if ($('sluttid').value) tidStr += '‚Äì' + $('sluttid').value;
  
  var stedStr = $('sted').value || '‚Äî';
  if ($('adresse').value) stedStr += ', ' + $('adresse').value;
  if ($('by').value) stedStr += ', ' + $('by').value;
  
  var pris = buildPris() || '‚Äî';
  
  var html = '<div class="line"><span class="icon">üóì</span><span>' + datoStr + '</span></div>';
  html += '<div class="line"><span class="icon">üìå</span><span>' + ($('navn').value || '‚Äî') + '</span></div>';
  html += '<div class="line"><span class="icon">üïó</span><span>' + tidStr + '</span></div>';
  html += '<div class="line"><span class="icon">üíÉ</span><span>' + ($('dansetype').value || '‚Äî') + '</span></div>';
  html += '<div class="line"><span class="icon">üìç</span><span>' + stedStr + '</span></div>';
  html += '<div class="line"><span class="icon">üí∞</span><span>' + pris + '</span></div>';
  if ($('link').value) html += '<div class="line"><span class="icon">üé´</span><span>' + $('link').value + '</span></div>';
  
  $('previewContent').innerHTML = html;
}

// Bind preview updates
var fields = ['dato','navn','starttid','sluttid','dansetype','sted','adresse','by','prisType','prisOnline','prisDropin','link','recurring'];
for (var i = 0; i < fields.length; i++) {
  var el = $(fields[i]);
  if (el) {
    el.oninput = updatePreview;
    el.onchange = updatePreview;
  }
}

// Clear
$('clearBtn').onclick = function() {
  var savedName = $('kilde').value;
  $('eventForm').reset();
  $('kilde').value = savedName;
  $('by').value = 'K√∏benhavn';
  $('dato').valueAsDate = new Date();
  $('prisFields').style.display = 'block';
  $('addStatus').style.display = 'none';
  updatePreview();
};

// JSONP
function jsonp(url, cb) {
  var cbName = 'cb_' + Date.now() + '_' + Math.random().toString(36).substr(2,5);
  var script = document.createElement('script');
  window[cbName] = function(data) {
    delete window[cbName];
    script.remove();
    cb(null, data);
  };
  script.onerror = function() {
    delete window[cbName];
    script.remove();
    cb(new Error('Failed'));
  };
  script.src = url + (url.indexOf('?') > -1 ? '&' : '?') + 'callback=' + cbName;
  document.body.appendChild(script);
}

// Submit - USES EXISTING admin-import ACTION!
$('eventForm').onsubmit = function(e) {
  e.preventDefault();
  
  var btn = $('submitBtn');
  var status = $('addStatus');
  
  // Validate pris
  if ($('prisType').value === 'angiv' && !$('prisOnline').value && !$('prisDropin').value) {
    status.textContent = 'Angiv mindst √©n pris';
    status.className = 'status error';
    return;
  }
  
  // GEM EVENT-NAVNET F√òR SUBMIT!
  submittedEventName = $('navn').value.trim();
  
  btn.disabled = true;
  btn.innerHTML = '<span class="spinner"></span> Sender...';
  status.style.display = 'none';
  
  var kilde = $('kilde').value.trim();
  if (kilde) localStorage.setItem('dm_name', kilde);
  
  // Build URL with params - SAME AS ADMIN!
  var params = [];
  params.push('action=admin-import');
  params.push('dato=' + encodeURIComponent($('dato').value));
  params.push('navn=' + encodeURIComponent(submittedEventName));
  params.push('starttid=' + encodeURIComponent($('starttid').value));
  params.push('sluttid=' + encodeURIComponent($('sluttid').value));
  params.push('dansetype=' + encodeURIComponent($('dansetype').value));
  params.push('sted=' + encodeURIComponent($('sted').value));
  params.push('adresse=' + encodeURIComponent($('adresse').value));
  params.push('by=' + encodeURIComponent($('by').value));
  params.push('pris=' + encodeURIComponent(buildPris()));
  params.push('link=' + encodeURIComponent($('link').value));
  params.push('recurring=' + $('recurring').checked);
  params.push('kilde=' + encodeURIComponent(kilde + ' (arrangor)'));
  params.push('_=' + Date.now());
  
  var url = API + '?' + params.join('&');
  
  jsonp(url, function(err, data) {
    btn.disabled = false;
    btn.textContent = 'üöÄ Send event';
    
    if (err) {
      status.textContent = 'Kunne ikke sende. Pr√∏v igen.';
      status.className = 'status error';
      return;
    }
    
    if (data && data.success) {
      // Vis success med EVENT-NAVNET
      $('successEventName').textContent = 'üìå ' + submittedEventName;
      $('mainCard').style.display = 'none';
      $('successCard').style.display = 'block';
    } else if (data && data.error === 'DUPLICATE') {
      status.textContent = 'Dette event findes allerede';
      status.className = 'status error';
    } else {
      status.textContent = (data && data.text) || 'Noget gik galt';
      status.className = 'status error';
    }
  });
};

// Add another
$('addAnotherBtn').onclick = function() {
  $('clearBtn').click();
  $('mainCard').style.display = 'block';
  $('successCard').style.display = 'none';
};

// Init
$('dato').valueAsDate = new Date();
updatePreview();
</script>

</body>
</html>
