<!DOCTYPE html>
<html lang="da">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>DanceMap ‚Äì Arrang√∏r Portal</title>
  <link rel="icon" href="/dancemap-icon.svg" type="image/svg+xml">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: #0d1117;
      color: #e6edf3;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 24px 16px;
    }
    
    .header {
      display: flex;
      align-items: center;
      gap: 14px;
      margin-bottom: 24px;
      width: 100%;
      max-width: 440px;
    }
    
    .logo img { width: 52px; height: 52px; border-radius: 12px; }
    .header-text h1 { font-size: 20px; font-weight: 600; color: #e6edf3; margin-bottom: 2px; }
    .header-text .sub { font-size: 13px; color: #7d8590; }
    
    .card {
      background: #161b22;
      border-radius: 20px;
      width: 100%;
      max-width: 440px;
      padding: 28px 24px;
      position: relative;
    }
    
    .card::before {
      content: '';
      position: absolute;
      inset: -2px;
      border-radius: 22px;
      background: linear-gradient(90deg, #ff0000, #ff8000, #ffff00, #00ff00, #00ffff, #0080ff, #8000ff, #ff00ff, #ff0000);
      background-size: 400% 100%;
      animation: gradient-shift 8s linear infinite;
      z-index: -1;
    }
    
    @keyframes gradient-shift {
      0% { background-position: 0% 50%; }
      100% { background-position: 400% 50%; }
    }
    
    .intro { text-align: center; margin-bottom: 24px; }
    .intro h2 { font-size: 18px; font-weight: 600; margin-bottom: 8px; }
    .intro p { font-size: 14px; color: #8b949e; line-height: 1.5; }
    
    .tabs { display: flex; gap: 8px; margin-bottom: 20px; }
    .tab {
      flex: 1; padding: 12px; border-radius: 10px; border: 1px solid #30363d;
      background: transparent; color: #8b949e; font-size: 14px; font-weight: 500; cursor: pointer;
    }
    .tab:hover { border-color: #6366f1; }
    .tab.active { background: rgba(99, 102, 241, 0.15); border-color: #6366f1; color: #e6edf3; }
    .tab.cancel-tab.active { background: rgba(218, 54, 51, 0.15); border-color: #da3633; color: #f85149; }
    
    .tab-content { display: none; }
    .tab-content.active { display: block; }
    
    .field-row { margin-bottom: 14px; }
    .field-row label { display: block; font-size: 12px; margin-bottom: 6px; color: #7d8590; }
    .field-row input, .field-row select {
      width: 100%; padding: 12px 14px; border-radius: 10px; border: 1px solid #30363d;
      background: #0d1117; color: #e6edf3; font-size: 14px; font-family: inherit; outline: none;
    }
    .field-row input:focus, .field-row select:focus { border-color: #6366f1; }
    .field-row.two-col { display: flex; gap: 12px; }
    .field-row.two-col > div { flex: 1; }
    
    .checkbox-group {
      display: flex; align-items: center; gap: 12px; margin-bottom: 16px;
      padding: 14px; background: #0d1117; border-radius: 10px;
    }
    .checkbox-group input[type="checkbox"] { width: 20px; height: 20px; accent-color: #6366f1; }
    .checkbox-group label { font-size: 14px; color: #c9d1d9; cursor: pointer; }
    
    .btn-row { display: flex; gap: 10px; margin-top: 16px; }
    
    .submit-btn {
      flex: 1; padding: 16px; border-radius: 12px; border: none;
      background: #6366f1; color: white; font-size: 15px; font-weight: 600; cursor: pointer;
    }
    .submit-btn:hover { background: #5558e3; }
    .submit-btn:disabled { opacity: 0.6; cursor: not-allowed; }
    
    .clear-btn {
      padding: 16px 20px; border-radius: 12px; border: 1px solid #30363d;
      background: transparent; color: #7d8590; font-size: 15px; cursor: pointer;
    }
    .clear-btn:hover { border-color: #f85149; color: #f85149; }
    
    .cancel-btn {
      flex: 1; padding: 16px; border-radius: 12px; border: none;
      background: #da3633; color: white; font-size: 15px; font-weight: 600; cursor: pointer;
    }
    .cancel-btn:hover { background: #c42b28; }
    
    .status {
      text-align: center; padding: 14px; border-radius: 10px; margin-top: 16px; font-size: 14px; display: none;
    }
    .status.success { background: rgba(63, 185, 80, 0.15); color: #3fb950; display: block; }
    .status.error { background: rgba(248, 81, 73, 0.15); color: #f85149; display: block; }
    
    .preview-card { background: #21262d; border-radius: 12px; padding: 14px 16px; margin-bottom: 16px; }
    .preview-label { font-size: 11px; color: #7d8590; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 10px; }
    .preview-content { font-size: 14px; color: #c9d1d9; line-height: 1.6; }
    .preview-content .line { display: flex; gap: 8px; margin-bottom: 4px; }
    .preview-content .icon { width: 20px; text-align: center; }
    
    .footer { margin-top: 24px; text-align: center; font-size: 12px; color: #484f58; }
    .footer a { color: #6366f1; text-decoration: none; }
    
    .lock-icon { font-size: 48px; margin-bottom: 16px; }
    .password-input { text-align: center; letter-spacing: 8px; font-size: 24px; font-weight: 600; }
    
    .success-card { text-align: center; }
    .success-icon { font-size: 48px; margin-bottom: 16px; }
    .success-message h3 { font-size: 18px; margin-bottom: 8px; }
    .success-message p { color: #8b949e; font-size: 14px; line-height: 1.5; }
    .add-another {
      margin-top: 20px; padding: 12px 24px; border-radius: 10px; border: 1px solid #30363d;
      background: transparent; color: #e6edf3; font-size: 14px; cursor: pointer;
    }
    .add-another:hover { border-color: #6366f1; background: rgba(99, 102, 241, 0.1); }
    
    .spinner {
      display: inline-block; width: 16px; height: 16px; border: 2px solid rgba(255,255,255,0.3);
      border-radius: 50%; border-top-color: white; animation: spin 0.8s linear infinite;
      margin-right: 8px; vertical-align: middle;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
  </style>
</head>
<body>

<div class="header">
  <div class="logo"><img src="/dancemap-icon.svg" alt="DanceMap" /></div>
  <div class="header-text">
    <h1>DanceMap for Arrang√∏rer</h1>
    <div class="sub">Del dit event med dansemilj√∏et</div>
  </div>
</div>

<!-- PASSWORD GATE -->
<div class="card" id="passwordCard">
  <div class="intro">
    <div class="lock-icon">üîí</div>
    <h2>Arrang√∏r-adgang</h2>
    <p>Indtast adgangskode for at forts√¶tte</p>
  </div>
  <div class="field-row">
    <input type="password" id="password" class="password-input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢" maxlength="4" />
  </div>
  <button class="submit-btn" onclick="checkPassword()">Forts√¶t</button>
  <div class="status" id="passwordStatus"></div>
</div>

<!-- MAIN PORTAL -->
<div class="card" id="mainCard" style="display:none;">
  <div class="tabs">
    <button class="tab active" onclick="switchTab('add')">‚ûï Tilf√∏j event</button>
    <button class="tab cancel-tab" onclick="switchTab('cancel')">‚ùå Aflys event</button>
  </div>
  
  <!-- ADD EVENT TAB -->
  <div class="tab-content active" id="addTab">
    <div class="intro">
      <h2>üéâ Tilf√∏j dit event</h2>
      <p>Dit event g√•r live med det samme!</p>
    </div>
    
    <form id="eventForm">
      <div class="field-row">
        <label>Dit navn / organisation *</label>
        <input type="text" id="arrang√∏r" required />
      </div>
      
      <div class="field-row">
        <label>Event navn *</label>
        <input type="text" id="navn" required />
      </div>
      
      <div class="field-row">
        <label>Dato *</label>
        <input type="date" id="dato" required />
      </div>
      
      <div class="field-row two-col">
        <div><label>Start *</label><input type="time" id="starttid" required /></div>
        <div><label>Slut *</label><input type="time" id="sluttid" required /></div>
      </div>
      
      <div class="field-row">
        <label>Dansetype *</label>
        <select id="dansetype" required>
          <option value="Salsa">Salsa</option>
          <option value="Bachata">Bachata</option>
          <option value="Kizomba">Kizomba</option>
          <option value="Zouk">Zouk</option>
          <option value="Tango">Tango</option>
          <option value="Swing">Swing</option>
          <option value="Latin">Latin</option>
          <option value="Festival">Festival</option>
        </select>
      </div>
      
      <div class="field-row">
        <label>Sted *</label>
        <input type="text" id="sted" required />
      </div>
      
      <div class="field-row">
        <label>Adresse *</label>
        <input type="text" id="adresse" required />
      </div>
      
      <div class="field-row">
        <label>By *</label>
        <input type="text" id="by" value="K√∏benhavn" required />
      </div>
      
      <div class="field-row">
        <label>Pristype</label>
        <select id="prisType">
          <option value="angiv">Angiv priser</option>
          <option value="gratis">Gratis</option>
          <option value="kontakt">Kontakt arrang√∏r</option>
        </select>
      </div>
      
      <div id="prisFields">
        <div class="field-row two-col">
          <div><label>Online pris (kr)</label><input type="text" id="prisOnline" placeholder="50" /></div>
          <div><label>Drop-in pris (kr)</label><input type="text" id="prisDropin" placeholder="70" /></div>
        </div>
        <div class="field-row">
          <label>Billet-link (valgfrit)</label>
          <input type="url" id="billetLink" placeholder="https://..." />
        </div>
      </div>
      
      <div class="checkbox-group">
        <input type="checkbox" id="recurring" />
        <label for="recurring">Gentager ugentligt</label>
      </div>
      
      <div id="previewCard" class="preview-card">
        <div class="preview-label">Forh√•ndsvisning</div>
        <div id="previewContent" class="preview-content"></div>
      </div>
      
      <div class="btn-row">
        <button type="button" class="clear-btn" onclick="clearForm()">Ryd</button>
        <button type="submit" class="submit-btn" id="submitBtn">üöÄ Publicer</button>
      </div>
      
      <div class="status" id="addStatus"></div>
    </form>
  </div>
  
  <!-- CANCEL EVENT TAB -->
  <div class="tab-content" id="cancelTab">
    <div class="intro">
      <h2>‚ùå Aflys et event</h2>
      <p>Angiv hvilket event der skal aflyses</p>
    </div>
    
    <form id="cancelForm">
      <div class="field-row">
        <label>Dit navn / organisation *</label>
        <input type="text" id="cancelArrang√∏r" required />
      </div>
      
      <div class="field-row">
        <label>Event navn *</label>
        <input type="text" id="cancelNavn" required />
      </div>
      
      <div class="field-row">
        <label>Event dato *</label>
        <input type="date" id="cancelDato" required />
      </div>
      
      <div class="field-row">
        <label>√Örsag (valgfrit)</label>
        <input type="text" id="cancel√Örsag" />
      </div>
      
      <div class="btn-row">
        <button type="button" class="clear-btn" onclick="clearCancelForm()">Ryd</button>
        <button type="submit" class="cancel-btn" id="cancelBtn">üóëÔ∏è Aflys event</button>
      </div>
      
      <div class="status" id="cancelStatus"></div>
    </form>
  </div>
</div>

<!-- SUCCESS CARD -->
<div class="card success-card" id="successCard" style="display:none;">
  <div class="success-icon" id="successIcon">üéâ</div>
  <div class="success-message">
    <h3 id="successTitle">Event publiceret!</h3>
    <p id="successText">Dit event er nu live p√• DanceMap.</p>
  </div>
  <button class="add-another" onclick="resetToForm()">‚Üê Tilbage til portalen</button>
</div>

<div class="footer">
  <a href="/">‚Üê Tilbage til DanceMap</a>
</div>

<script>
const API = 'https://script.google.com/macros/s/AKfycbyLdLh5KIpFPOp0lOLZkJOBdkBOKRn3leJVDx4my1MXfhrqVGnCe7g6kVX_OeG9V73E/exec';
const PASSWORD = '2026';

// Elements
const $ = id => document.getElementById(id);
const fields = {
  arrang√∏r: $('arrang√∏r'), navn: $('navn'), dato: $('dato'),
  starttid: $('starttid'), sluttid: $('sluttid'), dansetype: $('dansetype'),
  sted: $('sted'), adresse: $('adresse'), by: $('by'),
  prisType: $('prisType'), prisOnline: $('prisOnline'), prisDropin: $('prisDropin'),
  billetLink: $('billetLink'), recurring: $('recurring')
};

// Password check
function checkPassword() {
  if ($('password').value === PASSWORD) {
    $('passwordCard').style.display = 'none';
    $('mainCard').style.display = 'block';
    localStorage.setItem('dancemap_arrang√∏r_access', 'true');
    loadSavedName();
  } else {
    $('passwordStatus').textContent = '‚ùå Forkert kode';
    $('passwordStatus').className = 'status error';
  }
}

if (localStorage.getItem('dancemap_arrang√∏r_access') === 'true') {
  $('passwordCard').style.display = 'none';
  $('mainCard').style.display = 'block';
  loadSavedName();
}

$('password').onkeyup = e => { if (e.key === 'Enter') checkPassword(); };

// Load/save name
function loadSavedName() {
  const saved = localStorage.getItem('dancemap_arrang√∏r_name');
  if (saved) {
    fields.arrang√∏r.value = saved;
    $('cancelArrang√∏r').value = saved;
  }
}

fields.arrang√∏r.onblur = () => {
  const name = fields.arrang√∏r.value.trim();
  if (name) {
    localStorage.setItem('dancemap_arrang√∏r_name', name);
    $('cancelArrang√∏r').value = name;
  }
};

// Tab switching
function switchTab(tab) {
  document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
  document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
  if (tab === 'add') {
    document.querySelector('.tab:first-child').classList.add('active');
    $('addTab').classList.add('active');
  } else {
    document.querySelector('.tab.cancel-tab').classList.add('active');
    $('cancelTab').classList.add('active');
  }
}

// Pristype handling
$('prisType').onchange = function() {
  $('prisFields').style.display = this.value === 'angiv' ? 'block' : 'none';
  updatePreview();
};

// Build pris string
function buildPrisString() {
  const pt = fields.prisType.value;
  if (pt === 'gratis') return 'Gratis';
  if (pt === 'kontakt') return 'Kontakt arrang√∏r';
  const o = fields.prisOnline.value.trim();
  const d = fields.prisDropin.value.trim();
  if (o && d) return o + ' kr (online) / ' + d + ' kr (drop-in)';
  if (o) return o + ' kr (online)';
  if (d) return d + ' kr (drop-in)';
  return '';
}

// Preview
function updatePreview() {
  const dage = ['S√∏n','Man','Tir','Ons','Tor','Fre','L√∏r'];
  const mdr = ['jan','feb','mar','apr','maj','jun','jul','aug','sep','okt','nov','dec'];
  
  let datoStr = '‚Äî';
  if (fields.dato.value) {
    const d = new Date(fields.dato.value);
    if (!isNaN(d.getTime())) {
      datoStr = dage[d.getDay()] + ' ' + d.getDate() + '. ' + mdr[d.getMonth()];
      if (fields.recurring.checked) datoStr += ' üîÅ';
    }
  }
  
  let tidStr = fields.starttid.value || '‚Äî';
  if (fields.sluttid.value) tidStr += '‚Äì' + fields.sluttid.value;
  
  let stedStr = fields.sted.value || '‚Äî';
  if (fields.adresse.value) stedStr += ', ' + fields.adresse.value;
  if (fields.by.value) stedStr += ', ' + fields.by.value;
  
  const pris = buildPrisString() || '‚Äî';
  
  $('previewContent').innerHTML = `
    <div class="line"><span class="icon">üóì</span><span>${datoStr}</span></div>
    <div class="line"><span class="icon">üìå</span><span>${fields.navn.value || '‚Äî'}</span></div>
    <div class="line"><span class="icon">üïó</span><span>${tidStr}</span></div>
    <div class="line"><span class="icon">üíÉ</span><span>${fields.dansetype.value || '‚Äî'}</span></div>
    <div class="line"><span class="icon">üìç</span><span>${stedStr}</span></div>
    <div class="line"><span class="icon">üí∞</span><span>${pris}</span></div>
  `;
}

// Update preview on any change
Object.values(fields).forEach(f => {
  if (f?.addEventListener) {
    f.addEventListener('input', updatePreview);
    f.addEventListener('change', updatePreview);
  }
});

// Clear form
function clearForm() {
  const savedName = fields.arrang√∏r.value;
  $('eventForm').reset();
  fields.arrang√∏r.value = savedName;
  fields.by.value = 'K√∏benhavn';
  fields.dato.valueAsDate = new Date();
  $('prisFields').style.display = 'block';
  $('addStatus').style.display = 'none';
  updatePreview();
}

function clearCancelForm() {
  const savedName = $('cancelArrang√∏r').value;
  $('cancelForm').reset();
  $('cancelArrang√∏r').value = savedName;
  $('cancelStatus').style.display = 'none';
}

// JSONP helper
function jsonp(url) {
  return new Promise((resolve, reject) => {
    const cb = 'cb_' + Date.now() + '_' + Math.random().toString(36).substr(2,5);
    const script = document.createElement('script');
    window[cb] = data => { delete window[cb]; script.remove(); resolve(data); };
    script.onerror = () => { delete window[cb]; script.remove(); reject(new Error('Failed')); };
    script.src = url + (url.includes('?') ? '&' : '?') + 'callback=' + cb;
    document.body.appendChild(script);
  });
}

// ADD EVENT FORM
$('eventForm').onsubmit = async (e) => {
  e.preventDefault();
  
  const btn = $('submitBtn');
  const status = $('addStatus');
  
  // Validate pris
  if (fields.prisType.value === 'angiv' && !fields.prisOnline.value && !fields.prisDropin.value) {
    status.textContent = '‚ö†Ô∏è Angiv mindst √©n pris';
    status.className = 'status error';
    return;
  }
  
  btn.disabled = true;
  btn.innerHTML = '<span class="spinner"></span> Sender...';
  status.style.display = 'none';
  
  const arrang√∏r = fields.arrang√∏r.value.trim();
  if (arrang√∏r) localStorage.setItem('dancemap_arrang√∏r_name', arrang√∏r);
  
  const params = new URLSearchParams();
  params.set('action', 'arrang√∏r-submit');
  params.set('dato', fields.dato.value);
  params.set('navn', fields.navn.value);
  params.set('starttid', fields.starttid.value);
  params.set('sluttid', fields.sluttid.value);
  params.set('dansetype', fields.dansetype.value);
  params.set('sted', fields.sted.value);
  params.set('adresse', fields.adresse.value);
  params.set('by', fields.by.value);
  params.set('pris', buildPrisString());
  params.set('link', fields.billetLink.value);
  params.set('recurring', fields.recurring.checked);
  params.set('kilde', arrang√∏r);
  params.set('indsendt', new Date().toISOString().split('T')[0]);
  params.set('_', Date.now());
  
  try {
    const data = await jsonp(API + '?' + params.toString());
    if (data.success) {
      showSuccess('üéâ', 'Event publiceret!', '"' + fields.navn.value + '" er nu live p√• DanceMap.');
    } else {
      status.textContent = data.error === 'DUPLICATE' ? '‚ö†Ô∏è Dette event findes allerede' : (data.text || 'Noget gik galt');
      status.className = 'status error';
    }
  } catch (err) {
    status.textContent = '‚ùå Kunne ikke sende. Pr√∏v igen.';
    status.className = 'status error';
  }
  
  btn.disabled = false;
  btn.textContent = 'üöÄ Publicer';
};

// CANCEL EVENT FORM
$('cancelForm').onsubmit = async (e) => {
  e.preventDefault();
  
  const btn = $('cancelBtn');
  const status = $('cancelStatus');
  
  btn.disabled = true;
  btn.innerHTML = '<span class="spinner"></span> Aflyser...';
  status.style.display = 'none';
  
  const params = new URLSearchParams();
  params.set('action', 'arrang√∏r-cancel');
  params.set('navn', $('cancelNavn').value);
  params.set('dato', $('cancelDato').value);
  params.set('√•rsag', $('cancel√Örsag').value || 'Ikke angivet');
  params.set('kilde', $('cancelArrang√∏r').value);
  params.set('_', Date.now());
  
  try {
    const data = await jsonp(API + '?' + params.toString());
    if (data.success) {
      showSuccess('‚úÖ', 'Event aflyst', '"' + $('cancelNavn').value + '" er fjernet fra DanceMap.');
    } else {
      status.textContent = data.text || 'Kunne ikke finde eventet';
      status.className = 'status error';
    }
  } catch (err) {
    status.textContent = '‚ùå Kunne ikke sende. Pr√∏v igen.';
    status.className = 'status error';
  }
  
  btn.disabled = false;
  btn.textContent = 'üóëÔ∏è Aflys event';
};

function showSuccess(icon, title, text) {
  $('mainCard').style.display = 'none';
  $('successCard').style.display = 'block';
  $('successIcon').textContent = icon;
  $('successTitle').textContent = title;
  $('successText').textContent = text;
}

function resetToForm() {
  clearForm();
  clearCancelForm();
  $('mainCard').style.display = 'block';
  $('successCard').style.display = 'none';
  switchTab('add');
}

// Init
$('dato').valueAsDate = new Date();
updatePreview();
</script>

</body>
</html>
